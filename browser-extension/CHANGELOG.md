# 更新日志

所有版本的更新记录都将在此文件中展示。

## [8.0.0] - 2026-02-11

### ✨ 新增功能

#### 1. 状态指示器
- 插件图标徽章显示当前状态
  - 开启时显示绿色 "ON" 徽章
  - 关闭时无徽章
  - 检测到复制限制时显示橙色 "!" 提示


#### 2. 智能识别复制限制
- 自动检测页面是否有复制限制
- 检测类型包括：
  - CSS 限制 (`user-select: none`)
  - 事件拦截 (`oncopy`, `onpaste` 等)
  - 登录/VIP 遮罩
  - 特定网站类型
- 插件关闭时，检测到限制会在图标上显示提示


#### 3. Shadow DOM 深度处理
- 递归遍历所有 Shadow DOM
- 自动处理动态创建的 Shadow DOM
- 监听 Shadow DOM 内部变化
- 使用 WeakSet 避免重复处理

#### 4. iframe 全面支持
- 处理同源 iframe（直接访问内容）
- 尝试处理跨域 iframe（通过 postMessage）
- 监听新创建的 iframe
- 递归处理嵌套 iframe

#### 5. 智能 DOM 观察器
- 批量处理 DOM 变更（防抖优化）
- 过滤无效变更（文本节点、脚本标签等）
- 标记已处理元素避免重复操作
- 性能统计功能
- 属性变更监听（style、class、disabled、readonly）

### 🌐 新增网站支持（实验性）

- **头歌实践教学平台** (educoder.net)

### 🔧 功能优化

#### 插件架构
- 从油猴脚本迁移到浏览器插件
- 使用 Manifest V3 标准
- 分离 background.js 和 content.js
- 添加完善的错误处理机制

#### 内存管理
- 自动清理 MutationObserver
- 清理事件监听器
- 功能清理回调机制
- 页面卸载时自动清理

#### 性能优化
- 节流和防抖处理
- 批量 DOM 操作
- 避免重复处理相同元素
- 智能过滤无效变更

### 🐛 修复问题

- 修复 CSDN 登录遮罩残留问题
- 修复插件关闭后页面无法交互的问题
- 修复部分网站复制限制无法解除的问题
- 修复浮动输入框在某些网站无法呼出的问题

---

## [7.3.4] - 2026-01-31

### 修复
- 修复了 `utils.createFloatingInputBox` 在定义前被调用的问题
- 添加了 jQuery 存在性检查，防止超星页面在没有 jQuery 时报错
- 移除了有问题的 `removeEventListeners` 函数（该函数未被使用且实现有问题）

### 增强
- 键盘事件监听改为使用捕获阶段，并添加 `stopPropagation()` 阻止事件传播，确保脚本优先处理
- 新增 Shadow DOM 支持，`unlockCssRestrictions` 现在会递归处理 Shadow DOM 内的元素
- 新增 `processAllDocuments` 函数，支持递归处理 iframe 内的文档（同域）
- 新增备用激活方式：**双击输入框**可呼出浮动输入框，作为 `Ctrl+M` 的备用方案

## [7.3.3] - 早期版本

### 功能
- 解除网页复制粘贴限制
- 支持学习通、PTA、CSDN、飞书云文档等网站
- 支持模拟人工输入（Ctrl+M 呼出浮动输入框）
- 自动移除 VIP 遮罩层
- 拦截 XHR 请求修改响应数据
- 针对飞书、PTA、超星等网站提供专用解锁逻辑

### 技术特性
- 使用 `@run-at document-start` 确保脚本尽早执行
- 监听 DOM 变化动态解除限制
- 覆盖原生事件监听方法阻止限制事件

## 版本号说明

本项目使用 [语义化版本](https://semver.org/lang/zh-CN/)：

- **主版本号**：重大功能更新或架构变更
- **次版本号**：新增功能或重大改进
- **修订号**：问题修复或小优化

---

---

## 反馈与建议

如果您有任何建议或发现了 bug，欢迎通过以下方式反馈：

- 邮箱：EchoRunning@outlook.com
- GitHub Issues

感谢您对「解除复制粘贴限制」插件的支持！
